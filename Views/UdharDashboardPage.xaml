<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    x:Class="vyaparsathi.Views.UdharDashboardPage"
    Title="Udhar"
    BackgroundColor="#F3F4F6">

    <ScrollView>
        <VerticalStackLayout Padding="16" Spacing="18">

            <!-- Header 
            <VerticalStackLayout Spacing="4">
                <Label Text="Udhar Dashboard"
                       FontSize="24"
                       FontAttributes="Bold"
                       TextColor="#0F172A"/>
                <Label Text="Track dues and overdue payments"
                       FontSize="13"
                       TextColor="#64748B"/>
            </VerticalStackLayout>-->

            <!-- KPI Cards -->
            <Grid ColumnSpacing="14" RowSpacing="14">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <Frame Grid.Row="0" Grid.Column="0" Style="{StaticResource Card}">
                    <VerticalStackLayout>
                        <Label Text="Total Pending" FontSize="12" TextColor="#6B7280"/>
                        <Label x:Name="TotalPendingLabel"
                               FontSize="22"
                               FontAttributes="Bold"
                               TextColor="#DC2626"/>
                    </VerticalStackLayout>
                </Frame>

                <Frame Grid.Row="0" Grid.Column="1" Style="{StaticResource Card}">
                    <VerticalStackLayout>
                        <Label Text="Overdue Amount" FontSize="12" TextColor="#6B7280"/>
                        <Label x:Name="OverdueAmountLabel"
                               FontSize="22"
                               FontAttributes="Bold"
                               TextColor="#B91C1C"/>
                    </VerticalStackLayout>
                </Frame>

                <Frame Grid.Row="1" Grid.Column="0" Style="{StaticResource Card}">
                    <VerticalStackLayout>
                        <Label Text="Due This Week" FontSize="12" TextColor="#6B7280"/>
                        <Label x:Name="DueThisWeekLabel"
                               FontSize="22"
                               FontAttributes="Bold"
                               TextColor="#F97316"/>
                    </VerticalStackLayout>
                </Frame>

                <Frame Grid.Row="1" Grid.Column="1" Style="{StaticResource Card}">
                    <VerticalStackLayout>
                        <Label Text="Customers Due" FontSize="12" TextColor="#6B7280"/>
                        <Label x:Name="CustomerDueCountLabel"
                               FontSize="22"
                               FontAttributes="Bold"
                               TextColor="#2563EB"/>
                    </VerticalStackLayout>
                </Frame>
            </Grid>

            <!-- Recent Udhar -->
            <Grid ColumnDefinitions="*,Auto">
                <Label Text="Recent Pending Udhar"
                       FontSize="18"
                       FontAttributes="Bold"
                       TextColor="#0F172A"/>

                <Button Text="View All"
                        Grid.Column="1"
                        FontSize="13"
                        BackgroundColor="Transparent"
                        TextColor="#2563EB"
                        Clicked="OnViewAllClicked"/>
            </Grid>

            <CollectionView x:Name="RecentUdharCollection"
                            SelectionMode="None"
                            EmptyView="No pending udhar">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame CornerRadius="16"
                               BackgroundColor="White"
                               Padding="14"
                               Margin="0,6"
                               HasShadow="True">

                            <Grid ColumnDefinitions="*,Auto">
                                <VerticalStackLayout Spacing="4">
                                    <Label Text="{Binding CustomerName}"
                                           FontSize="15"
                                           FontAttributes="Bold"/>
                                    <Label Text="{Binding DueText}"
                                           FontSize="12"
                                           TextColor="{Binding StatusColor}"/>
                                </VerticalStackLayout>

                                <Label Grid.Column="1"
                                       Text="{Binding Amount, StringFormat='â‚¹{0:N0}'}"
                                       FontSize="16"
                                       FontAttributes="Bold"
                                       TextColor="#DC2626"/>
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
