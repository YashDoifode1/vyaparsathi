<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    x:Class="vyaparsathi.Views.UdharHistoryPage"
    Title="Udhar History"
    BackgroundColor="#F8FAFC">

    <VerticalStackLayout Padding="20" Spacing="20">

        <!-- Header -->
        <VerticalStackLayout Spacing="4">
            <Label Text="Udhar History"
                   FontSize="26"
                   FontAttributes="Bold"
                   TextColor="#0F172A"/>

            <Label Text="Track pending udhar payments"
                   FontSize="14"
                   TextColor="#64748B"/>
        </VerticalStackLayout>

        <!-- Filters -->
        <HorizontalStackLayout Spacing="12">
            <Picker x:Name="CustomerPicker"
                    Title="Filter by Customer"
                    SelectedIndexChanged="OnCustomerFilterChanged"
                    HorizontalOptions="FillAndExpand"/>

            <Entry x:Name="SearchEntry"
                   Placeholder="Search customer"
                   BackgroundColor="White"
                   ClearButtonVisibility="WhileEditing"
                   TextChanged="OnSearchTextChanged"
                   HorizontalOptions="FillAndExpand"/>
        </HorizontalStackLayout>

        <!-- Udhar List -->
        <CollectionView x:Name="UdharCollection"
                        SelectionMode="None"
                        EmptyView="No pending udhar found.">

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Frame CornerRadius="18"
                           Padding="16"
                           Margin="0,6"
                           BackgroundColor="White"
                           HasShadow="True">

                        <VerticalStackLayout Spacing="10">

                            <!-- Name & Amount -->
                            <Grid ColumnSpacing="12">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <Label Text="{Binding CustomerName}"
                                       FontSize="16"
                                       FontAttributes="Bold"
                                       TextColor="#1E293B"/>

                                <Label Text="{Binding Amount, StringFormat='â‚¹{0:N2}'}"
                                       Grid.Column="1"
                                       FontSize="18"
                                       FontAttributes="Bold"
                                       TextColor="#DC2626"/>
                            </Grid>

                            <!-- Notes -->
                            <Label Text="{Binding Notes}"
                                   FontSize="13"
                                   TextColor="#475569"
                                   LineBreakMode="TailTruncation"/>

                            <!-- Date -->
                            <Label Text="{Binding Date, StringFormat='{0:dd MMM yyyy}'}"
                                   FontSize="12"
                                   TextColor="#94A3B8"/>

                            <!-- Action -->
                            <Button Text="Mark as Paid"
                                    HeightRequest="44"
                                    CornerRadius="14"
                                    FontAttributes="Bold"
                                    BackgroundColor="#16A34A"
                                    TextColor="White"
                                    Clicked="OnMarkPaidClicked"
                                    CommandParameter="{Binding .}"/>

                        </VerticalStackLayout>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

    </VerticalStackLayout>
</ContentPage>
