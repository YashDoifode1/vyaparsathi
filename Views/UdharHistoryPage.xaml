<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    x:Class="vyaparsathi.Views.UdharHistoryPage"
    Title="Udhar History"
    BackgroundColor="#F8FAFC">

    <VerticalStackLayout Padding="20" Spacing="20">

        <!-- Header -->
        <VerticalStackLayout Spacing="4">
            <Label Text="Udhar History"
                   FontSize="26"
                   FontAttributes="Bold"
                   TextColor="#0F172A"/>

            <Label Text="Track pending and cleared udhar payments"
                   FontSize="14"
                   TextColor="#64748B"/>
        </VerticalStackLayout>

        <!-- Search -->
        <Entry x:Name="SearchEntry"
               Placeholder="Search customer name"
               HeightRequest="48"
               BackgroundColor="White"
               ClearButtonVisibility="WhileEditing"
               TextChanged="OnSearchTextChanged"/>

        <!-- Udhar List -->
        <CollectionView x:Name="UdharCollection"
                        SelectionMode="None">

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Frame CornerRadius="18"
                           Padding="16"
                           Margin="0,6"
                           BackgroundColor="White"
                           HasShadow="True">

                        <VerticalStackLayout Spacing="10">

                            <!-- Top Row -->
                            <Grid ColumnSpacing="12">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <Label Text="{Binding CustomerName}"
                                       FontSize="16"
                                       FontAttributes="Bold"
                                       TextColor="#1E293B"/>

                                <Label Text="{Binding Amount, StringFormat='â‚¹{0:F2}'}"
                                       Grid.Column="1"
                                       FontSize="18"
                                       FontAttributes="Bold"
                                       TextColor="#DC2626"/>
                            </Grid>

                            <!-- Notes -->
                            <Label Text="{Binding Notes}"
                                   FontSize="13"
                                   TextColor="#475569"
                                   LineBreakMode="TailTruncation"/>

                            <!-- Date + Status -->
                            <Grid ColumnSpacing="10">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <Label Text="{Binding Date, StringFormat='{0:dd MMM yyyy}'}"
                                       FontSize="12"
                                       TextColor="#94A3B8"/>

                                <Label Text="UNPAID"
                                       Grid.Column="1"
                                       FontSize="11"
                                       FontAttributes="Bold"
                                       TextColor="#DC2626"
                                       IsVisible="{Binding IsPaid, Converter={StaticResource InverseBoolConverter}}"/>
                            </Grid>

                            <!-- Action -->
                            <Button Text="Mark as Paid"
                                    HeightRequest="44"
                                    CornerRadius="14"
                                    FontAttributes="Bold"
                                    BackgroundColor="#16A34A"
                                    TextColor="White"
                                    IsVisible="{Binding IsPaid, Converter={StaticResource InverseBoolConverter}}"
                                    Clicked="OnMarkPaidClicked"/>
                        </VerticalStackLayout>

                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>

        </CollectionView>

    </VerticalStackLayout>
</ContentPage>
