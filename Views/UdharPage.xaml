<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    x:Class="vyaparsathi.Views.UdharPage"
    Title="Udhar"
    BackgroundColor="#F8FAFC">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="24">

            <!-- Header -->
            <VerticalStackLayout Spacing="6">
                <Label Text="Udhar Entry"
                       FontSize="26"
                       FontAttributes="Bold"
                       TextColor="#0F172A"/>

                <Label Text="Record credit given to customers"
                       FontSize="14"
                       TextColor="#64748B"/>
            </VerticalStackLayout>

            <!-- Udhar Entry Card -->
            <Frame CornerRadius="18"
                   BackgroundColor="White"
                   Padding="18"
                   HasShadow="True">

                <VerticalStackLayout Spacing="16">

                    <!-- Customer -->
                    <VerticalStackLayout Spacing="6">
                        <Label Text="Customer"
                               FontSize="13"
                               FontAttributes="Bold"
                               TextColor="#1E293B"/>
                        <Picker x:Name="CustomerPicker"
                                Title="Select customer"
                                HeightRequest="48"
                                BackgroundColor="#F9FAFB"/>
                    </VerticalStackLayout>

                    <!-- Amount -->
                    <VerticalStackLayout Spacing="6">
                        <Label Text="Udhar Amount (₹)"
                               FontSize="13"
                               FontAttributes="Bold"
                               TextColor="#1E293B"/>
                        <Entry x:Name="AmountEntry"
                               Placeholder="Enter amount"
                               Keyboard="Numeric"
                               HeightRequest="48"
                               FontSize="16"
                               BackgroundColor="#F9FAFB"/>
                    </VerticalStackLayout>

                    <!-- Notes -->
                    <VerticalStackLayout Spacing="6">
                        <Label Text="Notes (Optional)"
                               FontSize="13"
                               FontAttributes="Bold"
                               TextColor="#1E293B"/>
                        <Editor x:Name="NotesEditor"
                                Placeholder="Reason / due date / remarks"
                                HeightRequest="90"
                                BackgroundColor="#F9FAFB"/>
                    </VerticalStackLayout>

                    <!-- Save -->
                    <Button Text="Save Udhar"
                            HeightRequest="52"
                            CornerRadius="16"
                            FontAttributes="Bold"
                            BackgroundColor="#DC2626"
                            TextColor="White"
                            Clicked="OnSaveUdharClicked"/>
                </VerticalStackLayout>
            </Frame>

            <!-- History Header -->
            <VerticalStackLayout Spacing="4">
                <Label Text="Udhar History"
                       FontSize="18"
                       FontAttributes="Bold"
                       TextColor="#0F172A"/>
                <Label Text="Previously recorded credits"
                       FontSize="13"
                       TextColor="#64748B"/>
            </VerticalStackLayout>

            <!-- Udhar History List -->
            <CollectionView x:Name="UdharCollection"
                            SelectionMode="None">

                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame CornerRadius="18"
                               Padding="16"
                               Margin="0,6"
                               BackgroundColor="White"
                               HasShadow="True">

                            <VerticalStackLayout Spacing="10">

                                <!-- Name & Amount -->
                                <Grid ColumnSpacing="12">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <Label Text="{Binding CustomerName}"
                                           FontSize="15"
                                           FontAttributes="Bold"
                                           TextColor="#1E293B"/>

                                    <Label Text="{Binding Amount, StringFormat='₹{0:F2}'}"
                                           Grid.Column="1"
                                           FontSize="16"
                                           FontAttributes="Bold"
                                           TextColor="#DC2626"/>
                                </Grid>

                                <!-- Notes -->
                                <Label Text="{Binding Notes}"
                                       FontSize="13"
                                       TextColor="#475569"
                                       LineBreakMode="TailTruncation"/>

                                <!-- Date & Action -->
                                <Grid ColumnSpacing="12">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <Label Text="{Binding Date, StringFormat='{0:dd MMM yyyy}'}"
                                           FontSize="12"
                                           TextColor="#94A3B8"/>

                                    <Button Text="Delete"
                                            Grid.Column="1"
                                            FontSize="12"
                                            CornerRadius="12"
                                            Padding="12,4"
                                            BackgroundColor="#EF4444"
                                            TextColor="White"
                                            Clicked="OnDeleteUdharClicked"
                                            CommandParameter="{Binding .}"/>
                                </Grid>

                            </VerticalStackLayout>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
